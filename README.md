# docker-practice
Docker practice, SOA HSE APRIL 2023

DockerHub:
https://hub.docker.com/repository/docker/mxryd/service
https://hub.docker.com/repository/docker/mxryd/server

**Содержимое:**
- Исходный код, включая сгенерированные исходные файлы для gRPC
- Файл .proto, использованный при генерации кода для gRPC
- Файлы service.dockerfile, server.dockerfile, docker-compose.yml, requirements.txt отвечающие за сборку образа
- Файл ser.avsc, содержащий Avro-схему для сериализуемой структуры данных
- Файл client.py, который может быть использован для упрощения взаимодействия по UDP с прокси-сервисом

----
***Все команды исполняются из главной папки (DockerShenanigans)***

**Установка с нуля:**
1. Клонирование репозитория
2. Сборка контейнеров по образам: `sudo docker-compose build service1 service2 service3 service4 service5 service6 service7 server`
3. Запуск собранных контейнеров: `sudo docker-compose up service1 service2 service3 service4 service5 service6 service7 server`

**Соединение:**
- Простой вариант (работает с IP контейнеров 0.0.0.0 на хост-машине, в файле легко указать любой другой нужный):
Запустить файл client.py интерпретатором Python 3.6 или выше: LINUX: `python3 client.py`
- Сложный вариант:
Любой другой удобный вариант UDP-подключения к прокси-сервису на порт 2000

**Взаимодействие:**
Список команд ограничивается только: `get_result {Name}`, где {Name} может быть одним из следующих строковых литералов:
- Native - соответствует встроенной сериализации pickle стандартной библиотеки Python 3.6+
- XML - соответствует сериализации с использованием XML (независимые библиотеки xmltodict и dicttoxml)
- JSON - соответствует встроенной сериализации json стандартной библиотеки Python 3.6+
- GoogleProtoBuff - соответствует сериализации с использованием библиотеки Google Protocol Buffers
- ApacheAvro - соответствует сериализации с использованием библиотеки Apache Avro
- YAML - соответствует сериализации с использованием YAML (библиотека PyYAML)
- MessagePack - соответствует сериализации с использованием Message Pack (библиотека msgpack)
- all - соответствует запросу о сериализации с использованием всех вариантов

**Возвращаемый результат:**
- Для некорректных команд или требуемых типов: строка вида `RESPONSE: Описание ошибки`
- Для одиночных вариантов сериализации: строка вида `RESPONSE: {Name} - {Size} bytes - {SerializationTime} ms - {DeserializationTime} ms`, где
*{Name}* - имя типа сериализации
*{Size}* - размер в байтах тестируемой структуры
*{SerializationTime}* и *{DeserializationTime}* - среднее время сериализации и десериализации структуры данным типом сериализации (количество повторений для вычисления среднего времени может быть задано с помощью переменной окружения `ITER_COUNT` на этапе сборки)
- Для варианта "all": строки, аналогичные предыдущему случаю, по одной для каждого поддерживаемого типа сериализации

----
**Особенности реализации:**
1. Для реализации микросервисов, отвечающих за сериализацию и десериализацию, использован конструкт небольшого gRPC-сервера с одной процедурой.
2. Каждый микросервис идентичен другому в функционале и может работать с любыми форматами в зависимости от gRPC-запроса.
3. За создание gRPC-запросов отвечает прокси-сервис. Внутри него же и определяется тип сериализации. Каждому микросервису, как и требуется, отправляются запросы только одного типа, определяемого его номером.
4. Мультикаст в силу архитектуры выполняется не через группу мультикаста, а через мультитред-вызов gRPC. Небольшая цена за удобство в реализации. Не совсем то, что требовалось изначально, но, тем не менее, как мне кажется, приемлемая в рамках данного задания альтернатива, предоставляющая тот же функционал в чуть иной форме.
5. Тестируемая структура представляет собой словарь (dictionary) языка Python, в качестве ключа имеющий строку и в качестве значений имеющий различные иные типы данных: числа (целое/нецелое), строка, массив чисел, подсловарь строки-числа, булево значение.
6. Строение кода предоставляет здравые возможности и варианты по расширению функционала при необходимости. В некоторых местах осознанно сделаны срезы углов.
